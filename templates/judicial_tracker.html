{% extends "dashboard_base.html" %}

{% block content %}
<div class="space-y-8">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold text-white mb-2" data-i18n="vaad_suchak">VaadSuchak (Tracker)</h1>
            <p class="text-slate-400" data-i18n="monitor_cases">Monitor your active legal cases.</p>
        </div>
        <a href="/judicial/intake"
            class="bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-xl transition-colors"
            data-i18n="new_case">
            + New Case
        </a>
    </div>

    <!-- Cases Grid -->
    <div id="cases-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Loading State -->
        <div class="col-span-full text-center py-20 text-slate-500" data-i18n="loading_cases">
            Loading cases...
        </div>
    </div>
</div>

<script>
    const stageOrder = ["Pre-Filing", "Filing", "Notice Issued", "Written Statement", "Evidence Submission", "Hearing", "Arguments", "Judgment", "Execution", "Closed"];

    async function loadCases() {
        try {
            const res = await fetch('/cases');
            const cases = await res.json();
            const container = document.getElementById('cases-container');

            if (cases.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-20 border border-dashed border-slate-800 rounded-3xl">
                        <p class="text-slate-400 mb-4" data-i18n="no_cases_found">No cases found.</p>
                        <a href="/judicial/intake" class="text-amber-400 hover:underline" data-i18n="file_your_first_case">File your first case</a>
                    </div>
                `;
                return;
            }

            container.innerHTML = cases.map(c => {
                const stageIdx = stageOrder.indexOf(c.current_stage);
                const progress = stageIdx >= 0 ? Math.round(((stageIdx + 1) / stageOrder.length) * 100) : 10;

                return `
                <a href="/cases/${c.id}" class="block glass p-6 rounded-2xl border border-white/10 hover:border-amber-500/50 transition-all hover:-translate-y-1 hover:shadow-lg group">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="text-lg font-bold text-white group-hover:text-amber-400 transition-colors">${c.title}</h3>
                            <p class="text-xs text-slate-500 uppercase tracking-wider mt-1">${c.case_type}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-bold 
                            ${c.status === 'Open' ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/20' :
                        c.status === 'Closed' ? 'bg-slate-500/20 text-slate-400 border border-slate-500/20' :
                            'bg-amber-500/20 text-amber-400 border border-amber-500/20'}">
                            ${c.status}
                        </span>
                    </div>

                    <!-- Parties -->
                    <div class="flex items-center gap-2 text-xs mb-3">
                        <span class="text-emerald-400">${c.plaintiff_name}</span>
                        <span class="text-slate-600">vs.</span>
                        <span class="text-rose-400">${c.defendant_name}</span>
                        <span class="ml-auto px-2 py-0.5 rounded text-[10px] font-bold uppercase
                            ${c.user_role === 'Plaintiff' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-rose-500/20 text-rose-400'}">
                            You: ${c.user_role}
                        </span>
                    </div>
                    <!-- CNR Badge -->
                    <div class="flex items-center gap-2 text-xs mb-3">
                        ${c.cnr_number
                        ? `<span class="px-2 py-0.5 rounded font-mono text-[10px] font-bold bg-cyan-500/20 text-cyan-400 border border-cyan-500/20 tracking-wider">CNR: ${c.cnr_number}</span>`
                        : `<span class="px-2 py-0.5 rounded text-[10px] font-bold bg-amber-500/20 text-amber-400 border border-amber-500/20">âš  CNR Pending</span>`
                    }
                    </div>
                    
                    <div class="space-y-2">
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-slate-400">Stage</span>
                            <span class="text-white font-medium">${c.current_stage}</span>
                        </div>
                        <div class="w-full bg-slate-800 rounded-full h-1.5 overflow-hidden">
                            <div class="bg-amber-500 h-full rounded-full transition-all" style="width: ${progress}%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-slate-600">
                            <span>${c.hearings ? c.hearings.length : 0} hearings</span>
                            <span>${new Date(c.updated_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                        </div>
                    </div>
                </a>`;
            }).join('');

        } catch (err) {
            console.error(err);
        }
    }
    loadCases();
</script>
{% endblock %}